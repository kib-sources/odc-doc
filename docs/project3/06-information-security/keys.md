---
sidebar_position: 10
---
# Ключи системы, хеш-функции, подписи

## Выбор хеш-функции и алгоритма подписи.

Вы можете выбрать различные хеш-функции
и алгоритмы подписи
для **каждой** банкноты.

Данные алгоритмы указаны в полях:
* `sign_algorithm`
* `hash_algorithm`

в [заголовке банкноты](../04-banknote/header.md).

Это делает систему ODC чрезвычайно гибкой. 

## mpk, mok

Банк-эмитент имеет одну пару 
**несменяемых**
мастер ключей:
1. Приватный мастер-ключ (`mpk` -- private master key)
2. Публичный мастер-ключ (`mok` -- private master key)

Ключ `mok` всем известен.

Ключ `mpk` держится в секрете.

:::danger[Замечание]
Если будет скомпрометирован
ключ `mpk`, то будет скомпрометирована
вся система. 
Нужно позаботиться о тщательной защите этого ключа.
:::

Так же нужно иметь в веду, что кроме конфиденциальности
ключа нужно подумать о его доступности. 
В случае если носитель с `mpk` будет сломан без возможности
восстановления, вы не сможете выпускать 
новые `bpk\bok` ключи.     

Данные ключи используются крайне редко.
Только как мастер-ключи для генерирования
(`bpk`, `bok`) ключей.

## bpk, bok

С помощью приватного мастер-ключа подписываются новые ключи
банка-эмитента, которых может быть неогранниченное количество.

* bok -- Bank Open Key
* bpk -- Bank Private Key



### expire

Для создания новой пары ключей
(`bpk`, `bok`)
банк-эмитент 
создаёт 64-битную переменную
`expire`, 
представляющую 
[UNIX время](https://ru.wikipedia.org/wiki/Unix-время)
валидности этих ключей.

Любые действия, *кроме проверки подписи*,
после времени `expire`
невалидные

:::note[Для информации]
Обращаем ещё раз внимание,
что валидация по `bok`
уже созданных до истечения времени `expire`
всегда является валидной операцией.

Однако при достижении `expire`
времени новые банкноты 
с помощью `bpk` уже не эмитируются.
:::

### подпись bok ключа

Является ли `bok` настоящим ключём банка-эмитента?
Для этого необходимо все новые `bok`
ключи подписывать `mpk` ключом.

При создании новой пары
(`bpk`, `bok`)
банк-эмитент 
определяет
создаёт подпись:
```
[hash(bok; expire)](mpk)
```
Благодаря этой подписи, все кошельки,
владеющие `mok` смогут подтвердить, что
`bok` сгенерирован банком-эмитентом.

Так же до компрометации
`mpk`
или взлома алгоритма хеширования
или взлома ассиметрического алгоритма шифрования
невозможно подделать данную подпись.

Подпись `[hash(bok; expire)](mpk)` может
высылаться на регулярной основе через
регулярное обновление системы.

Так же можно отправлять эту подпись при
оффлайн передаче банкноты.

:::warning[Замечание]
При передаче подписи
`[hash(bok; expire)](mpk)`
следует так же передать
переменную `expire`.
В противном случае принимающая сторона не 
сможет взять хеш `hash(bok; expire`
и проверить подпись ключом `mok`.
:::


## spk, sok

На кошельке существует
пара ключей:

* `spk` -- SIM private key 
* `sok` -- SIM open key

Ключ `spk` храниться на доверенном носителе информации
и недоступен для извлечения пользователем.
Например это может быть SMART карта 
(в частности SIM карта).

Ключ `sok` открыт и в секрете не держиться.

Данные ключи генерируются банком-эмитентом.
Хеш от `sok` подписывается  
одним из `bpk` ключей:
```python
[hash(sok)](bpk)
```

Данная подпись так же храниться в кошельке 
и служит доказательством валидности указанных
(`spk`, `sok`) пары.

### создание SIM ключей

Пара (`spk`, `sok`) генерируются
банком-эмитентом.

Приватный ключ `spk`
записывается в *доверенную среду*
(смарт карту, SIM карту и т.д.)