---
sidebar_position: 1001
---
# ODC v1

:::note[Замечание]
Эта страница носит архивный характер.
Вкрации дано описание устаревшего формата ODCv1.

Для общего развития и для интересующихся.
:::

Первая версия протокола была разработана в 2021 году
как PoC самой идеи offline платежей.

В отличие от ODCv3 и ODCv2 в первой версии протокола
отсутствовал
[banknote-counter словарь](architecture/wallet/banknote-counter-dict.md).

Вместо пар (`banknote_id`, `counter`)
каждое владелие блоком 
подписывалось одноразовым ключём `otpk`.

## otpk-otok

Ключи `otpk` (One-Time private Key)
и `otok` (One-Time public key)

генерировались
в *доверенной среде*
кошелька.
Ключ `otok` подписывался `sok` кошельком
и записывался внутри блокчейна.

## Блок OdcbBlockChainV1


| Наименование поля | Описание                                                                                     | Пример значения \ замечание                                                                   |
|-------------------|----------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------|
| `banknote_id`     | Уникальный UUID банкноты                                                                     | `280bdff8-a345-4854-a60b-b57251ec4d0e`                                                        |
| `parent_hash`     | Ссылка на `hash` предыдущего блока                                                           |                                                                                               |
| `otok`            | Одноразовый публичный ключ.                                                                  |                                                                                               |
| `sok`             | `sok` нового владельца                                                                       |                                                                                               |
| `sign_otok`       | Подпись `hash[otok](spk)` для подтверждения того, что `otok` сгенерирован в доверенной среде |                                                                                               |
| `salt0`           | Соль получателья                                                                             |                                                                                               |
| `hash0`           | Хеш от полей выше.                                                                           |                                                    | 
| `sign_hash0`      | Подписанный хеш ключом `spk` нового владельца                                                |
| `salt`            | соль                                                                                         | (опционально) проставляется банком-эмитентом, при доступе в онлайн для подтверждения передачи |
| `hash`            | хеш от полей выше.                                                                           | (опционально) проставляется банком-эмитентом, при доступе в онлайн для подтверждения передачи |
| `sign_hash`       | подпись старого владельца ключом `otpk` предыдущего блока.                                   | (опционально) проставляется банком-эмитентом, при доступе в онлайн для подтверждения передачи |

Поля `bank_id` отсутствовало. Алгоритм ODCv1 мог работать только в рамках одного банка-эмитента.

## Алгоритм

В рамках ODCv1 
можно было передать только одну банкноту.
Понятие "сдачи" не было.

Для передачи более одной банкноты 
нужно было инициировать алгоритм передачи много 
раз.

Алгоритм:
1. Отправитель отправлял банкноту получателю 
2. Валидация банкноты и отправителя получателем.
2. Получатель создавал в доверенной среде пару `otok`, `otpk`. Инициировал создание нового блока. Получатель проставляет все поля, кроме `salt` , `hash`  и `sign_hash`
3. Получатель отправлял отправителю новый блок
4. Отправитель подписывал новый блок ключом `otpk` последнего старого блока. Удалял в доверенной среде пару (`otpk`, `otok`) Отправлял новый блок получателю
5. Получатель -- новый владелец банкноты.

